<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Dataset Explorer</title>
  <style>
    /* Basic styling for the explorer */
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .search-bar {
      margin-bottom: 20px;
    }
    .tags {
      margin-bottom: 20px;
    }
    .tag {
      display: inline-block;
      background-color: #eee;
      padding: 5px 10px;
      margin: 5px;
      border-radius: 5px;
      cursor: pointer;
    }
    .tag.selected {
      background-color: #cce5ff;
    }
    .sort-bar {
      margin-bottom: 20px;
    }
    .dataset {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .dataset:hover {
      background-color: #f9f9f9;
    }
    .dataset-title {
      font-size: 1.2em;
      font-weight: bold;
    }
    .dataset-detail {
      margin: 5px 0;
    }
    /* The full details section is hidden by default */
    .dataset-full {
      display: none;
      margin-top: 10px;
      border-top: 1px dashed #ccc;
      padding-top: 10px;
    }
    /* Styling for tags shown within each dataset */
    .dataset-tag {
      display: inline-block;
      background-color: #ddd;
      padding: 2px 5px;
      margin: 2px;
      border-radius: 3px;
    }
    /* Updated custom tooltip styling */
    .tooltip {
      position: relative;
      display: inline-block;
    }
    .tooltip .tooltiptext {
      visibility: hidden;
      background-color: #f9f9f9; /* Light background */
      color: #000;               /* Dark text */
      text-align: center;
      padding: 5px 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      position: absolute;
      z-index: 1;
      top: 110%;               /* Appear under the button */
      left: 50%;
      transform: translateX(-50%);
      white-space: nowrap;     /* Single line */
      opacity: 0;
      transition: opacity 0.3s;
    }
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body>
  <h1>Dataset Explorer</h1>
  <div class="search-bar">
    <input type="text" id="search-input" placeholder="Search datasets...">
  </div>
  <div class="tags" id="tags-container">
    <!-- Tags will be dynamically inserted here -->
  </div>
  <div class="sort-bar">
    <label for="sort-select">Sort by:</label>
    <select id="sort-select">
      <option value="name">Name (A-Z)</option>
      <option value="date_latest">Date (Latest)</option>
      <option value="date_earliest">Date (Earliest)</option>
    </select>
  </div>
  <div id="datasets-container">
    <!-- Matching datasets will be displayed here -->
  </div>

  <script>
    // Retrieve dataset and tag specifications passed from Flask via Jinja2.
    let datasets = JSON.parse('[{"companion": "Not available", "download": "https://huggingface.co/datasets/EleutherAI/proof-pile-2", "name": "ArXiv", "notes": "Valuable for training models on high-level mathematical and scientific content. Data collected in a snapshot taken in 2023 by RedPajama.", "size": "29 billion tokens", "summary": "A vast dataset consisting of research papers scraped from the ArXiv website, capturing a wide array of scientific literature and advanced mathematical concepts.", "tags": ["math", "competition", "tag3", "to_clean"]}, {"companion": "Not available", "date": "2020-02-01", "download": "https://huggingface.co/datasets/AI-MO/aimo-validation-amc/", "name": "AMC", "notes": "Used as a filtering round for more advanced competitions. Historical data is beneficial for practice and analysis.", "size": "3 levels x 25 multiple-choice questions per year", "summary": "Historical data from the American Math Competition, designed for high-school students as a preliminary round before AIME. It includes multiple levels of difficulty.", "tags": ["math", "competition", "tag1", "tag2", "to_clean"]}, {"companion": "https://arxiv.org/abs/2110.14168", "date": "2024-01-01", "download": "https://github.com/openai/grade-school-math", "name": "GSM8k", "notes": "Reflects real-world educational content; useful for benchmarking model performance on elementary math problems.", "size": "8,500 problems (~5 MB)", "summary": "The Grade School Math (GSM) dataset contains 8,500 problems designed to evaluate mathematical reasoning at a grade-school level, curated and annotated by humans.", "tags": ["math", "competition", "tag5", "tag6", "tag7", "tag8", "to_clean"]}, {"companion": "Not available", "date": "2020-01-01", "download": "various locations including https://huggingface.co/datasets/di-zhang-fdu/AIME_1983_2024", "name": "AIME", "notes": "New questions become available annually. Note that some questions may already be present on the internet and could be included in pretraining corpora.", "size": "15 questions per year", "summary": "A collection of historical questions from the American Invitational Mathematics Examination, a prestigious high-school competition that challenges advanced problem-solving skills.", "tags": ["math", "competition", "2020", "benchmark", "question:human", "to_clean"]}, {"companion": "Not available", "date": "2021-01-01", "download": "https://huggingface.co/datasets/MatrixStudio/Codeforces-Python-Submissions", "name": "CodeForces", "notes": "Includes unit tests and code snippets. Extensive dataset useful for automated code evaluation systems.", "size": "700,000 samples (~1.7 GB)", "summary": "A dataset derived from CodeForces, featuring competitive programming submissions that provide a comprehensive resource for studying coding challenges and algorithmic problem solving.", "tags": ["code", "competition", "tag4", "to_clean"]}]');
    let tagData = JSON.parse('{"benchmark": "datasets often used for benchmarking purposes", "competition": "datasets from various competitions", "education": "education-related datasets", "math": "dataset focused on math"}');

    // Create an array of available tag names from the tagData.
    let availableTags = Object.keys(tagData);

    // Render the tags using custom tooltip (with the tag's description shown on hover).
    function renderTags() {
      const tagsContainer = document.getElementById("tags-container");
      tagsContainer.innerHTML = "";
      availableTags.forEach(tag => {
        // Create the tag element.
        const tagElem = document.createElement("span");
        tagElem.classList.add("tag");
        tagElem.textContent = tag;
        tagElem.addEventListener("click", () => {
          tagElem.classList.toggle("selected");
          filterDatasets();
        });

        // Create tooltip element.
        const tooltipText = document.createElement("span");
        tooltipText.classList.add("tooltiptext");
        tooltipText.textContent = tagData[tag];

        // Wrap the tag element in a tooltip container.
        const tooltipContainer = document.createElement("span");
        tooltipContainer.classList.add("tooltip");
        tooltipContainer.appendChild(tagElem);
        tooltipContainer.appendChild(tooltipText);

        tagsContainer.appendChild(tooltipContainer);
      });
    }

    // Retrieve the currently selected tags.
    function getSelectedTags() {
      return Array.from(document.getElementsByClassName("tag"))
        .filter(tagElem => tagElem.classList.contains("selected"))
        .map(tagElem => tagElem.textContent.toLowerCase());
    }

    // Render tags for a dataset with tooltips.
    function renderDatasetTags(tags) {
      if (!tags) return "";
      return tags.map(tag => {
        let tooltip = tagData[tag.toLowerCase()] || "";
        return `<span class="tooltip dataset-tag">${tag}
                  <span class="tooltiptext">${tooltip}</span>
                </span>`;
      }).join(" ");
    }

    // Filter and render datasets based on search input, selected tags, and sort order.
    function filterDatasets() {
      const searchTerm = document.getElementById("search-input").value.toLowerCase();
      const selectedTags = getSelectedTags();
      const sortValue = document.getElementById("sort-select").value;
      const datasetsContainer = document.getElementById("datasets-container");
      datasetsContainer.innerHTML = "";

      // Filter datasets by checking search term and tag match.
      let filtered = datasets.filter(ds => {
        // Basic search match in name, summary, or notes.
        const matchesSearch = ds.name.toLowerCase().includes(searchTerm) ||
                              ds.summary.toLowerCase().includes(searchTerm) ||
                              ds.notes.toLowerCase().includes(searchTerm);
        // For tag matching, check the ds.tags field if available, or fallback to text search.
        const matchesTags = selectedTags.length === 0 ||
          selectedTags.every(tag => {
            const inTags = ds.tags ? ds.tags.map(t => t.toLowerCase()).includes(tag) : false;
            const inText = ds.name.toLowerCase().includes(tag) ||
                           ds.summary.toLowerCase().includes(tag) ||
                           ds.notes.toLowerCase().includes(tag);
            return inTags || inText;
          });
        return matchesSearch && matchesTags;
      });

      // Sort datasets based on selected sort option.
      if (sortValue === "name") {
        filtered.sort((a, b) => a.name.localeCompare(b.name));
      } else if (sortValue === "date_latest") {
        filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
      } else if (sortValue === "date_earliest") {
        filtered.sort((a, b) => new Date(a.date) - new Date(b.date));
      }

      // Render each filtered dataset.
      filtered.forEach(ds => {
        const dsElem = document.createElement("div");
        dsElem.classList.add("dataset");

        // Minimal view: title, summary, size, creation date, and tags.
        dsElem.innerHTML = `
          <div class="dataset-minimal">
            <div class="dataset-title">${ds.name}</div>
            <div class="dataset-detail"><strong>Summary:</strong> ${ds.summary}</div>
            <div class="dataset-detail"><strong>Size:</strong> ${ds.size}</div>
            <div class="dataset-detail"><strong>Date Created:</strong> ${ds.date || "N/A"}</div>
          </div>
          <div class="dataset-full">
            <div class="dataset-detail"><strong>Download Location:</strong> <a href="${ds.download}" target="_blank">${ds.download}</a></div>
            <div class="dataset-detail"><strong>Notes:</strong> ${ds.notes}</div>
            <div class="dataset-detail"><strong>Companion Paper:</strong> ${
              ds.companion === "Not available" 
                ? "Not available" 
                : `<a href="${ds.companion}" target="_blank">${ds.companion}</a>`
            }</div>
            <div class="dataset-detail"><strong>Tags:</strong> ${renderDatasetTags(ds.tags)}</div>
          </div>
        `;
        // Toggle the display of the full details on click.
        dsElem.addEventListener("click", function() {
          const details = dsElem.querySelector(".dataset-full");
          details.style.display = (details.style.display === "block") ? "none" : "block";
        });
        datasetsContainer.appendChild(dsElem);
      });
    }

    // Listen for changes in the search input and sort selection.
    document.getElementById("search-input").addEventListener("input", filterDatasets);
    document.getElementById("sort-select").addEventListener("change", filterDatasets);

    // Initial render.
    renderTags();
    filterDatasets();
  </script>
</body>
</html>